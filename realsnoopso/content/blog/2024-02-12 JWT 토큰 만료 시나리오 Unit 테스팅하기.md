---
title: JWT í† í° ë§Œë£Œ ì‹œë‚˜ë¦¬ì˜¤ Unit í…ŒìŠ¤íŒ…í•˜ê¸°
date: 2024-02-12T00:00:32.169Z
---

# ë¬¸ì œ

Refresh Token ì¿ í‚¤ê°€ ë§Œë£Œ ë˜ì—ˆì„ ë•Œ ë¡œê·¸ì•„ì›ƒì´ ë˜ì§€ ì•ŠëŠ” í˜„ìƒì´ ë°˜ë³µì ìœ¼ë¡œ ì¼ì–´ë‚¬ë‹¤. ìš°ì„  ë²„ê·¸ë¥¼ ì¡ê¸°ëŠ” í–ˆìœ¼ë‚˜ ë§Œë£Œë˜ëŠ” ì¬í˜„ì´ ê¹Œë‹¤ë¡œì›Œ QAë¥¼ í•˜ëŠ”ë° ì–´ë ¤ì›€ì„ ê²ªì—ˆë‹¤.

# í•´ê²° ë°©ë²•

ë¡œì§ì— Unit í…ŒìŠ¤íŠ¸ë¥¼ ë„ì…í•˜ì—¬ ë¡œì§ì— ëŒ€í•œ ì•ˆì •ì„±ì„ íšë“í•˜ê³ ì í•œë‹¤.

# í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ì™œ ì¨ì•¼ í• ê¹Œ?

- ì˜ë¬´ê°ì— ì“°ëŠ”ê²Œ ì•„ë‹ˆë¼, ì‹¤ì§ˆì ì¸ ì´ë“ì„ ì–»ì„ ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.
- ì˜ˆë¥¼ ë“¤ì–´ í¬ë¡¬ì„ í´ë¦­í•´ì„œ í´ë¦­í´ë¦­í•˜ëŠ” ê²ƒì„ ìë™í™”ë¥¼ ì‹œí‚¬ ìˆ˜ ìˆëŠ” ê²ƒ
- ê°œë°œ ì‚¬ì´í´ì„ ì¤„ì´ê³ , ì‰½ê²Œ ë†“ì¹  ìˆ˜ ìˆëŠ” ë²„ê·¸ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ì¡ì•„ë‚¼ ìˆ˜ ìˆëŠ” ì¥ì ì´ ìˆìŒ
- ì½”ë“œê°€ ê·¸ì§€ê°™ìœ¼ë©´ ì• ì´ˆì— í…ŒìŠ¤íŠ¸ í•˜ê¸° í˜ë“¤ë‹¤
- ì—ëŸ¬ë„ ì¡ê³  ì„¤ê³„ë„ ê°œì„ í•˜ê³ 

# ì¢‹ì€ í…ŒìŠ¤íŠ¸ ì½”ë“œë€ ë¬´ì—‡ì¸ê°€?

- ì•ˆ ì¢‹ì€ í…ŒìŠ¤íŠ¸ ì½”ë“œ?
  - í…ŒìŠ¤íŠ¸ ì½”ë“œì˜ êµ¬í˜„ì´ ê·¸ëŒ€ë¡œ ë“œëŸ¬ë‚˜ëŠ” ê²½ìš°
  - ì¢‹ì€ í…ŒìŠ¤íŠ¸ ì½”ë“œë¼ëŠ” ê²ƒì€ ë¦¬íŒ©í† ë§ì„ í•˜ë”ë¼ë„ ë™ì¼í•˜ê²Œ í…ŒìŠ¤íŠ¸ë¥¼ í•  ìˆ˜ ìˆì–´ì•¼ í•¨
  - ì˜ˆë¥¼ ë“¤ë©´ axios ê°€ ë…¸ì¶œí•˜ëŠ” ê²ƒë„ ë¶ˆí–‰í•  ìˆ˜ ìˆìŒ

ìœ„ ì‚¬í•­ì„ ê³ ë ¤í•˜ì—¬ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸°ë¡œ í•˜ì˜€ë‹¤.

# í˜„í™©

í˜„ì¬ ì¸ì¦ê³¼ ê´€ë ¨ëœ ì‹œë‚˜ë¦¬ì˜¤ë“¤ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

1. ë¡œê·¸ì¸ì´ í•„ìš”í•œ APIë¥¼ í˜¸ì¶œ
   1. Access Tokenë§Œ ë§Œë£Œëœ ê²½ìš°
      - í† í° ì¬ë°œê¸‰ ì‹œë„
        - ì„±ê³µì‹œ API ì¬í˜¸ì¶œ
        - ì‹¤íŒ¨ì‹œ ë¡œê·¸ì•„ì›ƒ
   1. Access Tokenê³¼ Refresh Tokenì´ ë‘˜ ë‹¤ ë§Œë£Œëœ ê²½ìš°
      - ë¡œê·¸ì¸ì´ í•„ìš”í•œ APIë¥¼ í˜¸ì¶œí•˜ë©´ ë¡œê·¸ì•„ì›ƒ
1. ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ë¡œ ì´ë™
   1. Access Tokenë§Œ ë§Œë£Œëœ ê²½ìš°
      - í† í° ì¬ë°œê¸‰ ì‹œë„
        - ì„±ê³µì‹œ í•´ë‹¹ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        - ì‹¤íŒ¨ì‹œ ë¡œê·¸ì•„ì›ƒ
   2. Access Tokenê³¼ Refresh Tokenì´ ë‘˜ ë‹¤ ë§Œë£Œëœ ê²½ìš°
      - ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ë¥¼ ì´ë™í•˜ë©´ ë¡œê·¸ì•„ì›ƒ

ì°¸ê³ : Refresh Tokenì€ Access Token ë³´ë‹¤ ë§Œë£Œ ì‹œì ì´ ëŠ¦ê¸° ë•Œë¬¸ì— Access Tokenê°€ ì—†ê³  Refresh Tokenì´ ìˆëŠ” ê²½ìš°ëŠ” ì¡´ì¬í•˜ì§€ë§Œ ë°˜ëŒ€ì˜ ê²½ìš°ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤.

ì´ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì •ë¦¬í•˜ë©´ì„œ ë²Œì¨ ë¡œì§ì˜ ê²°í•¨ì„ ë°œê²¬í•  ìˆ˜ ìˆì—ˆë‹¤. ğŸ˜± ì•Œê³ ë³´ë‹ˆ Access Tokenì´ ë§Œë£Œë˜ë©´ ë¡œê·¸ì•„ì›ƒë˜ê³  ìˆì—ˆë‹¤. 2ë²ˆ ì‹œë‚˜ë¦¬ì˜¤ê°€ ì• ì´ˆì— ìœ íš¨í•˜ì§€ ì•Šì•˜ë˜ ê²ƒì´ë‹¤. ì–´ì©ì§€ ì˜¤ë¥˜ê°€ ì¶©ë¶„íˆ ë‚  ìˆ˜ ìˆëŠ”ë° ë²„ê·¸ê°€ ë°œê²¬ë˜ì§€ ì•Šì•„ ì˜ì•„í•´í•˜ê³  ìˆì—ˆë‹¤ ğŸ¤¨

# í…ŒìŠ¤íŠ¸ ì§„í–‰ ë°©ë²•

í…ŒìŠ¤íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‘ì€ ë‹¨ìœ„ì—ì„œ í° ë‹¨ìœ„ë¡œ ì‘ì„±í•´ ë‚˜ê°€ëŠ” ê²ƒì„ ëª©í‘œë¡œ í–ˆë‹¤. ì‘ì€ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì˜ ì•ˆì •ì„±ì´ íšë“ë˜ì–´ì•¼ í° ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì˜ ì•ˆì •ì„±ë„ í™•ë³´ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

1. Mock API ì‘ì„±
2. API unit í…ŒìŠ¤íŠ¸ ì‘ì„±
3. Component unit í…ŒìŠ¤íŠ¸ ì‘ì„±
4. (í•„ìš”í•œ ê²½ìš°) Page unit í…ŒìŠ¤íŠ¸ ì‘ì„±

## 1. ë¡œê·¸ì¸ì´ í•„ìš”í•œ APIë¥¼ í˜¸ì¶œí•˜ëŠ” ê²½ìš°

ìš°ì„  loginì´ í•„ìš”í•œ í•¨ìˆ˜ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ ê¸°ì¡´ì— ì‘ì„±í–ˆë˜ feed Mock APIë¥¼ ì‚´ì§ ë³€í˜•í–ˆë‹¤.

```jsx
http.post(`${API_BASE_URL}/feeds`, async ({ request, cookies }) => {
  if (cookies.accessToken === undefined) {
	return new HttpResponse(null, {
	  status: 401,
	  statusText: 'Unauthorized',
	})
  } // cookieì— ìˆëŠ” accesTokenì„ ê²€ì¦í•˜ë„ë¡ ë³€ê²½

  const body: CreateFeedDto = (await request.json()) as CreateFeedDto

  const feed = mockFeed.create({
	title: body.title,
	status: body.status,
	category: body.category as FeedCategories,
  })

  feeds.push(feed)

  const response: FeedDto = feed

  return HttpResponse.json(response)
}),
```

í˜„ì¬ apiëŠ” í˜¸ì¶œë˜ë©´ ë°˜ë“œì‹œ fetchApi ë¼ëŠ” í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  ìˆì—ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ì´ fetchApi í•¨ìˆ˜ë¥¼ ìœ„í•œ ìœ ë‹› í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í–ˆë‹¤.

```jsx
import { afterAll, beforeAll, describe, expect, it } from 'vitest'
import { setupServer } from 'msw/node'
import { createAuthMockApis } from '@/testing/auth'
import { API_BASE_URL } from '@/config/url'
import axios from 'axios'
import { feedsApis } from './feeds'
import { FeedStatusDto } from '@/types/feed.types'
import { createFeedMockApis } from '@/testing/feeds'

const server = setupServer()

beforeAll(() => {
  server.listen()
})

afterAll(() => {
  server.close()
})

describe('fetchApi', () => {
  it('401 ì—ëŸ¬ ë°œìƒ í›„, ìƒˆë¡œìš´ Access Tokenì„ ë°œê¸‰í•˜ëŠ” ë° ì‹¤íŒ¨í•˜ë©´, ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë°˜í™˜í•œë‹¤.', async () => {
    const { cookieHandlers, handlers: authHandlers } = createAuthMockApis({
      initialAccessToken: 'oldAccessToken',
      initialRefreshToken: 'oldRefreshToken',
    })

    const { handlers: feedHandlers } = createFeedMockApis({
      initialFeeds: [],
    })

    authHandlers.push(cookieHandlers.withoutRefreshToken)
    server.use(...authHandlers, ...feedHandlers)

    await axios.get(`${API_BASE_URL}/auth/google`)

    await expect(
      feedsApis.createFeeds({
        body: {
          body: '',
          buildingCode: '',
          pureBody: '',
          title: 'ì•ˆë…•',
          status: FeedStatusDto.PUBLIC,
        },
      }),
    ).rejects.toThrow()
  })

  it('401 ì—ëŸ¬ê°€ ë°œìƒí•˜ê³  ìƒˆë¡œìš´ Access Tokenì„ ë°œê¸‰ë°›ëŠ” ë° ì„±ê³µí•˜ë©´, ì½œë°± í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.', async () => {
    const { cookieHandlers, handlers: authHandlers } = createAuthMockApis({
      initialAccessToken: 'oldAccessToken',
      initialRefreshToken: 'oldRefreshToken',
    })

    const { handlers: feedHandlers } = createFeedMockApis({
      initialFeeds: [],
    })

    authHandlers.push(cookieHandlers.withoutAccessToken)
    server.use(...authHandlers, ...feedHandlers)

    await axios.get(`${API_BASE_URL}/auth/google`)

    const response = await feedsApis.createFeeds({
      body: {
        body: '',
        buildingCode: '',
        pureBody: '',
        title: 'ì•ˆë…•',
        status: FeedStatusDto.PUBLIC,
      },
    })

    expect(response.title).toBe('ì•ˆë…•')
  })

  ...
})
```

## 2. ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” ê²½ìš°

ìš°ì„  ì´ ì‹œë‚˜ë¦¬ì˜¤ì™€ ê´€ë ¨ëœ Mock APIë¥¼ ë¨¼ì € ì‘ì„±í–ˆë‹¤.

```jsx
// testing/auth.ts
import { API_BASE_URL } from '@/config/url'
import { HttpResponse, http } from 'msw'

let mockAccessToken: string = 'oldAccessToken'
export let mockRefreshToken: string = 'oldRefreshToken'

export class HttpError extends Error {
  statusCode: number

  constructor(message: string, statusCode: number) {
    super(message)
    this.statusCode = statusCode
  }
}

export const mockAccessTokenDto = {
  get: () => mockAccessToken,
  set: (newMockAccessToken: string) => {
    mockAccessToken = newMockAccessToken
  },
}

export const mockRefreshTokenDto = {
  get: () => mockRefreshToken,
  set: (newMockRefreshToken: string) => {
    mockRefreshToken = newMockRefreshToken
  },
}

export function createAuthMockApis({
  initialAccessToken,
  initialRefreshToken,
  callback,
}: {
  initialAccessToken: string
  initialRefreshToken: string
  callback?: () => void
}) {
  const loginHandlers = {
    default: http.get(`${API_BASE_URL}/auth/google`, async () => {
      return new HttpResponse(null, {
        headers: {
          'Set-Cookie':
            'accessToken=oldAccessToken,refreshToken=oldRefreshToken',
        },
      })
    }),
    withoutAccessToken: http.get(`${API_BASE_URL}/auth/google`, async () => {
      return new HttpResponse(null, {
        headers: {
          'Set-Cookie': 'refreshToken=oldRefreshToken;',
        },
      })
    }),
    withoutRefreshToken: http.get(`${API_BASE_URL}/auth/google`, async () => {
      return new HttpResponse(null, {
        headers: {
          'Set-Cookie': '',
        },
      })
    }),
  } // ì¿ í‚¤ê°€ ë§Œë£Œë˜ì–´ ì‚¬ë¼ì§€ëŠ” ê²½ìš°ë¥¼ ì´ë ‡ê²Œ ì‘ì„±í•˜ëŠ” ê²ƒì´ ì˜³ì„ê¹Œ?

  const handlers = [
    http.post(`${API_BASE_URL}/auth/refresh`, async ({ cookies }) => {
      if (cookies.refreshToken !== initialRefreshToken) {
        return new HttpResponse(null, { status: 401 })
      }
      return HttpResponse.json({ newAccessToken: 'newAccessToken' })
    }),
    http.get(`${API_BASE_URL}/auth/checklogin`, async ({}) => {
      return HttpResponse.json({
        accessToken: true,
        refreshToken: true,
        isLoggedIn: true,
      })
    }),
    ...
  ]

  callback?.()

  return {
    loginHandlers,
    handlers,
    initialAccessToken,
    initialRefreshToken,
  }
}
```

ê·¸ ë‹¤ìŒ ì´ Mock APIì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í–ˆë‹¤.

```jsx
// auth.spec.ts

import { afterAll, beforeAll, describe, expect, it } from "vitest";
import { setupServer } from "msw/node";
import { createAuthMockApis } from "@/testing/auth";
import { authApis } from "./auth";
import axios, { AxiosError } from "axios";
import { API_BASE_URL } from "@/config/url";

const server = setupServer();

beforeAll(() => {
  server.listen();
});

afterAll(() => {
  server.close();
});

describe("authApis", () => {
  it("Access Token ì¬ë°œê¸‰ì„ ì‹œë„í–ˆê³  ì„±ê³µí•œë‹¤.", async () => {
    const { cookieHandlers, handlers } = createAuthMockApis({
      initialAccessToken: "oldAccessToken",
      initialRefreshToken: "oldRefreshToken",
    });

    handlers.push(cookieHandlers.withoutAccessToken);
    server.use(...handlers);

    await axios.get(`${API_BASE_URL}/auth/google`);

    const { newAccessToken } = await authApis.refreshToken({});
    expect(newAccessToken).toBe("newAccessToken");
  });

  it("Access Token ì¬ë°œê¸‰ì„ ì‹œë„í•˜ê³  ì‹¤íŒ¨í•œë‹¤.", async () => {
    const { cookieHandlers, handlers } = createAuthMockApis({
      initialAccessToken: "oldAccessToken",
      initialRefreshToken: "oldRefreshToken",
    });

    handlers.push(cookieHandlers.withoutRefreshToken);
    server.use(...handlers);

    await axios.get(`${API_BASE_URL}/auth/google`);

    await expect(() => authApis.refreshToken({})).rejects.toThrowError(
      AuthError
    );

    try {
      await authApis.refreshToken({});
    } catch (error) {
      if (error instanceof AxiosError) {
        expect(error.response?.status).toBe(401);
      }
    }
  });
});
```

ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ì¼ ê²½ìš° AuthGuardë¼ëŠ” ì»´í¬ë„ŒíŠ¸ë¡œ ê°ì‹¸ì£¼ì–´ ë¡œì§ì„ ì²˜ë¦¬í•˜ê³  ìˆë‹¤. ì´ AuthGuard ì•ˆì— useLoginStatus ë¼ëŠ” í›…ì„ ë‘ì–´ ë‹¤ë¥¸ ê³³ì—ì„œë„ ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•˜ê³ ì í•  ë•Œ ì‚¬ìš©í•˜ë ¤ í•œë‹¤.

```jsx
import { authApis } from '@/apis/auth'
import { toast } from '@/components/ui/use-toast'
import { authKeys } from '@/lib/react-query-key'
import { useQuery } from '@tanstack/react-query'
import { isAxiosError } from 'axios'
import { useRouter } from 'next/router'
import { useCallback, useMemo } from 'react'

type LoginStatus = 'logging_in' | 'logged_in' | 'logged_out'

interface LoginStatusControls {
  refreshLoginStatus: () => void
  logout: () => void
}

// checkLoginStatus: LoginStatusë¥¼ ë°˜í™˜...
// -
export function useLoginStatus(): [LoginStatus, LoginStatusControls] {
  const router = useRouter()

  const { data: loginStatus, refetch } = useQuery({
    queryKey: authKeys.checkLoginStatus(),
    queryFn: async (): Promise<LoginStatus> => {
      const result = await authApis.checkLoginStatus({})

      if (result.accessToken) {
        return 'logged_in'
      } else {
        try {
          const { newAccessToken } = await authApis.refreshToken({})
          if (newAccessToken) {
            return 'logged_in'
          } else {
            return 'logged_out'
          }
        } catch (error) {
          if (isAxiosError(error) && error.response?.status === 401) {
            return 'logged_out'
          }
          return 'logged_out'
        }
      }
    },
    refetchInterval: Infinity,
    refetchOnMount: false,
    refetchOnWindowFocus: false,
    refetchOnReconnect: false,
  })

  const logout = useCallback(async function logout() {
    try {
      await authApis.logout({})
      router.push('/')
      toast({
        variant: 'default',
        description: 'Logged out. Please login again.',
      })
    } catch (e) {
      toast({
        variant: 'destructive',
        description: 'Failed to logout. Please try again.',
      })
    }
  }, [])

  const refreshLoginStatus = useCallback(async () => {
    return await refetch()
  }, [])

  const controls = useMemo((): LoginStatusControls => {
    return {
      refreshLoginStatus,
      logout,
    }
  }, [refreshLoginStatus, logout])

  return [loginStatus ?? 'logging_in', controls] as const
}
```

```jsx
// AuthGuard/index.spec.tsx
import { createAuthMockApis } from "@/testing/auth";
import { setupServer } from "msw/node";
import nextRouter from "next-router-mock";
import { afterAll, beforeAll, describe, expect, it, vi } from "vitest";
import { render, screen } from "@testing-library/react";
import AuthGuard from ".";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { UserProfileProvider } from "@/context/user-profile-context";
import { MyBuildingProfileProvider } from "@/context/my-building-context";
import { OverlayProvider } from "@toss/use-overlay";
import { useRouter } from "next/router";
import axios from "axios";
import { API_BASE_URL } from "@/config/url";

const server = setupServer();

beforeAll(() => {
  server.listen();
});

afterAll(() => {
  server.close();
});

describe("AuthGuard", () => {
  it("Access Tokenì™€ Refresh Tokenì´ ëª¨ë‘ ì¡´ì¬í•˜ëŠ” ê²½ìš° ë¡œê·¸ì•„ì›ƒ APIë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠëŠ”ë‹¤.", async () => {});
  it("Access Tokenì´ ë§Œë£Œë˜ê³  í† í° ì¬ë°œê¸‰ì´ ì„±ê³µí•œ ê²½ìš° ë¡œê·¸ì•„ì›ƒ APIë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠëŠ”ë‹¤.", async () => {
    const { cookieHandlers, handlers } = createAuthMockApis({
      initialAccessToken: "oldAccessToken",
      initialRefreshToken: "oldRefreshToken",
    });

    handlers.push(cookieHandlers.withoutAccessToken);
    server.use(...handlers);

    await axios.get(`${API_BASE_URL}/auth/google`);

    nextRouter.setCurrentUrl("/blocks/write");

    let apiCalled = false;

    vi.mock("next/navigation", async (importOriginal) => {
      await importOriginal();
      return {
        usePathname: () => "/blocks/write",
        useRouter: () => useRouter(),
        callback: () => {
          apiCalled = true;
        },
      };
    });

    render(
      <QueryClientProvider client={new QueryClient()}>
        <UserProfileProvider>
          <MyBuildingProfileProvider>
            <OverlayProvider>
              <AuthGuard>test</AuthGuard>
            </OverlayProvider>
          </MyBuildingProfileProvider>
        </UserProfileProvider>
      </QueryClientProvider>
    );

    expect(screen.getByText("test")).toBeInTheDocument();
    expect(apiCalled).toBe(false); // ì´ë ‡ê²Œ ë§ê³  ì •í™•íˆ íŠ¹ì • ë¶€ë¶„ì´ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€ ì•Œê¸° ìœ„í•´ì„  ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?

    server.resetHandlers();
  });

  it("Access Tokenì´ ë§Œë£Œë˜ê³  í† í° ì¬ë°œê¸‰ì´ ì‹¤íŒ¨í•œ ê²½ìš° ë¡œê·¸ì•„ì›ƒ APIë¥¼ í˜¸ì¶œí•œë‹¤.", async () => {
    nextRouter.setCurrentUrl("/blocks/write");

    let apiCalled = false;

    vi.mock("next/navigation", async (importOriginal) => {
      await importOriginal();
      return {
        usePathname: () => "/blocks/write",
        useRouter: () => useRouter(),
      };
    });

    const { cookieHandlers, handlers } = createAuthMockApis({
      initialAccessToken: "oldAccessToken",
      initialRefreshToken: "oldRefreshToken",
      callback: () => {
        apiCalled = true;
      },
    });

    handlers.push(cookieHandlers.withoutRefreshToken);
    server.use(...handlers);

    render(
      <QueryClientProvider client={new QueryClient()}>
        <UserProfileProvider>
          <MyBuildingProfileProvider>
            <OverlayProvider>
              <AuthGuard>test</AuthGuard>
            </OverlayProvider>
          </MyBuildingProfileProvider>
        </UserProfileProvider>
      </QueryClientProvider>
    );

    expect(apiCalled).toBe(true); // ì´ ë¶€ë¶„ ë¡œì§ì´ ì˜ ì´í•´ê°€ ì•ˆê°„ë‹¤.
  });

  it("Refresh Tokenì´ ë§Œë£Œëœ ê²½ìš° ë¡œê·¸ì•„ì›ƒ APIë¥¼ í˜¸ì¶œí•œë‹¤.", async () => {});
});
```

# ë°°ìš´ ì 

í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ë§Œì„ ì‘ì„±í–ˆì„ ë¿ì¸ë° ì‘ì€ ë‹¨ìœ„ì˜ ì½”ë“œë§Œ ë³´ë˜ í‰ì†Œì™€ëŠ” ë‹¬ë¦¬ ì¢€ ë” í¬ê³  ì¶”ìƒí™”ëœ ê´€ì ìœ¼ë¡œ ì½”ë“œë¥¼ ë°”ë¼ë³¼ ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤. ë•ë¶„ì— ê¸°ì¡´ì— ì¡´ì¬í–ˆë˜ ë¡œì§ì ì¸ ê²°í•¨ì„ ë°œê²¬í•  ìˆ˜ ìˆì—ˆë‹¤. ë°”ìœ ê²½ìš° í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ì§€ëŠ” ëª»í•´ë„, í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë§Œì€ ë°˜ë“œì‹œ ì‘ì„± í•´ì•¼ê² ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤.

- ì°¸ê³ 
  - [~ë¡œ ì¸í•´ ~ìƒí™©ì´ ë°œìƒí–ˆê³  ê·¸ ìƒí™©ì„ ~ë°©ì‹ìœ¼ë¡œ í•´ê²°í•œ ë‚´ìš©](https://velog.io/@psb7391/7%EC%9E%A5-%EA%B0%9C%EB%B0%9C%EC%9E%90%EC%9D%98-%EA%B8%80%EC%93%B0%EA%B8%B0-%EA%B8%B0%EC%88%A0-%EB%B8%94%EB%A1%9C%EA%B7%B8-%EC%89%BD%EA%B2%8C-%EC%93%B0%EA%B3%A0-%EC%9A%B4%EC%98%81%ED%95%98%EA%B8%B0)
- ë¸Œëœì¹˜: 20240216-auth-testing
